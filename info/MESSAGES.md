
Все общение происходит через поток сообщений. Первый байт сообщения определяет тип сообщения, а следующие четыре байта определяют длину остальной части сообщения (этот счетчик длины включает себя, но не байт типа сообщения). Остальное содержимое сообщения определяется типом сообщения. 

```text
Из описания выше у меня получился шаблон:
 Type(1) + Lenght(4) + Body(n)
```

- Type (1 байт):
Это первый байт сообщения, указывающий тип сообщения. Например, 'R' для аутентификации, 'Q' для запроса, 'E' для ошибки, 'D' для данных и так далее.

- Length (4 байта):
Это 4 байта, представляющие общую длину сообщения в сетевом порядке байтов (Big-endian). Длина включает себя саму и всё содержимое сообщения (включая Type, если оно есть).

- Body (переменная длина):
Это содержимое сообщения, которое зависит от типа. Например, для сообщения запроса это будет SQL-запрос, для сообщения аутентификации — параметры аутентификации.

Также стоит упомянуть про нулевые байты - \x00

Протокол PostgreSQL, нулевые байты используются для отделения параметров и завершения строки

```
В языках программирования, таких как C, строки представляются массивами символов, заканчивающимися нулевым байтом \x00
Этот байт указывает конец строки
```

****

### 1. Startup Message

Этот пакет отправляется клиентом при установке соединения и поэтому управляется postmaster-ом (главный процесс psql).

В отличии от остальных сообщений у startup message другой шаблон:
>   Length (4) + ProtocolVersion (4) + Parameters (n)
- Length (4 байта):
Это 4 байта, представляющие длину всего сообщения

- ProtocolVersion(4 байта):
Это 4 байта, указывающие версию протокола (3.0 как правило для новых версий).

- Parameters (переменная длина):
Это тот же Body(n), но представляющий собою параметры подключения такие как user, database, client_encoding и др.

### 2. Authentication
После получения StartupMessage сервер отправляет запрос на аутентификацию.

Пример MD5: 
> R\x00\x00\x00\x0C\x00\x00\x00\x05\x12\x34\x56\x78

- R — тип сообщения (Authentication Request).
- \x00\x00\x00\x0C — длина сообщения (12 байт).
- \x00\x00\x00\x05 — код метода аутентификации MD5 (5).
- \x12\x34\x56\x78 — соль (4 байта), используемая для хеширования.


При успешной аутентификации сервер отправляет сообщение AuthenticationOk:
> R\x00\x00\x00\x08\x00\x00\x00\x00

- R — это тип сообщения (Authentication).
- Длина сообщения 8 байт (\x00\x00\x00\x08).
- \x00\x00\x00\x00 — это означает, что аутентификация пройдена успешно.

### 3. Password Message (если сервер требует пароль)
Если сервер требует пароль, клиент должен отправить PasswordMessage.
> p\x00PASSWORD\x00
- p — это тип сообщения.
- $PASSWORD — это строка пароля (например, password).
- В конце завершающий нулевой байт.

### 4. Query Message
После успешной аутентификации клиент может отправлять запросы.
> Q\x00\x00\x00LENGTH\x00QUERY\x00
- Q — это тип сообщения (Query).
- LENGTH — длина сообщения, включая все байты (длина заголовка + длина запроса + 1 нулевой байт).
- QUERY — это текст SQL-запроса (например, SELECT 1;).
- В конце запроса обязательно должен быть нулевой байт.

### 5. Data Row Message
Ответ на запрос от сервера может быть в виде строки данных.
> D\x00\x00\x00LENGTH\x00COLUMN_COUNT\x00VALUE_LENGTH\x00VALUE...\x00

- D — это тип сообщения.
- LENGTH — общая длина сообщения.
- COLUMN_COUNT — количество колонок в результате.
- VALUE_LENGTH — длина значения в байтах.
- VALUE — это сами данные, которые сервер отправляет клиенту.

### 6. Command Complete Message
После успешного выполнения запроса сервер отправляет сообщение CommandComplete.
> C\x00\x00\x00LENGTH\x00COMMAND_TAG\x00

- C — это тип сообщения.
- LENGTH — длина сообщения.
- COMMAND_TAG — строка, описывающая команду (например, SELECT 1).

Пример:
> C\x00\x00\x00\x0ESELECT 1\x00

### 7. Error Response (если возникла ошибка)

Если сервер обнаружит ошибку, он отправит сообщение об ошибке.

> E\x00\x00\x00LENGTH\x00FIELD\x00MESSAGE\x00\x00

- E — это тип сообщения об ошибке.
- LENGTH — длина сообщения.
- FIELD — это тип поля ошибки (например, S для серьезности, M для текста ошибки).
- MESSAGE — это текст ошибки.
- Завершающий нулевой байт.

Пример:
> E\x00\x00\x00\x15SERROR\x00MInvalid query\x00\x00

### 8. Terminate Message
Когда клиент завершает соединение, он отправляет сообщение завершения.
> X\x00\x00\x00\x04
- X — это тип сообщения (Terminate).
- Длина сообщения всегда 4 байта.
